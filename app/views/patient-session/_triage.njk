<hr class="nhsuk-section-break nhsuk-section-break--visible nhsuk-section-break--l">

{% set isVaccinated = patientSession.report == ProgrammeOutcome.Vaccinated %}

{{ appHeading({
  level: 3,
  size: "m",
  title: __("patientSession.screen.title"),
  summary: patientSession.status.screen.text,
  attributes: {
    id: "screen"
  }
}) }}

{# Actions #}
{{ actionLink({
  classes: "nhsuk-u-margin-0",
  text: __("triage.edit.title"),
  href: patientSession.uri + "/edit/triage?referrer=" + referrer
}) if not options.needsTriage and not isVaccinated }}

{# Triage history #}
{% if options.hasTriage %}
  {{ appHeading({
    level: 4,
    size: "s",
    title: "Triage history"
  }) }}

  {{ appTimeline({
    items: timelineItems(patientSession.triageNotes)
  }) }}
{% endif %}

{% if options.needsTriage %}
  <div class="nhsuk-card">
    <div class="nhsuk-card__content">
      {% call fieldset({
        legend: {
          classes: "nhsuk-card__heading nhsuk-fieldset__legend--m",
          text: __("triage.label", { patient: patient })
        }
      }) %}
        {% set psdRadiosHtml = radios({
          classes: "nhsuk-radios--inline",
          fieldset: { legend: { text: __("triage.psd.label") } },
          items: booleanItems,
          decorate: "triage.psd"
        }) if account.canPrescribe %}

        {% set outcomeItems = injectConditionalHtml(triageOutcomeItems(patientSession.screenOutcomesForConsentMethod), ScreenOutcome.VaccinateIntranasal, psdRadiosHtml) if patientSession.programme.alternativeVaccine else triageOutcomeItems(patientSession.screenOutcomesForConsentMethod) %}

        {{ radios({
          hint: {
            text: patientSession.screenVaccinationMethod
          } if patientSession.screenVaccinationMethod,
          items: outcomeItems,
          decorate: "triage.outcome"
        }) }}

        {{ textarea({
          label: {
            text: __("triage.note.label") + " (optional)"
          },
          rows: 5,
          decorate: "triage.note"
        }) }}

        {{ button({
          classes: "nhsuk-u-margin-0",
          text: __("triage.confirm"),
          attributes: {
            formaction: patientSession.uri + "/new/triage?referrer=" + referrer
          }
        }) }}
      {% endcall %}
    </div>
  </div>
{% endif %}
